(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     48793,       1099]
NotebookOptionsPosition[     47930,       1077]
NotebookOutlinePosition[     48413,       1095]
CellTagsIndexPosition[     48370,       1092]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PredicateName", "[", "p_Symbol", "]"}], ":=", " ", "p"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Special", " ", "case", " ", "usable", " ", "for", " ", "simpler", " ", 
    "representation", " ", "of", " ", "propositional", " ", "logic"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PredicateName", "[", 
   RowBox[{"p_", "[", "x___", "]"}], "]"}], ":=", 
  "p"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PredicateSymbols", "[", 
   RowBox[{"Not", "[", "a_", "]"}], "]"}], " ", ":=", " ", 
  RowBox[{"PredicateSymbols", "[", "a", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PredicateSymbols", "[", 
   RowBox[{"a_", "\[And]", "b_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"PredicateSymbols", "[", "a", "]"}], "\[Union]", 
   RowBox[{"PredicateSymbols", "[", "b", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PredicateSymbols", "[", 
   RowBox[{"a_", "\[Or]", "b_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"PredicateSymbols", "[", "a", "]"}], "\[Union]", 
   RowBox[{"PredicateSymbols", "[", "b", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PredicateSymbols", "[", 
   RowBox[{"a_", "\[Implies]", "b_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"PredicateSymbols", "[", "a", "]"}], "\[Union]", 
   RowBox[{"PredicateSymbols", "[", "b", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PredicateSymbols", "[", 
   RowBox[{"p_Symbol", "[", "x_", "]"}], "]"}], ":=", " ", 
  RowBox[{"{", 
   RowBox[{"{", 
    RowBox[{"p", ",", " ", "1"}], "}"}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PredicateSymbols", "[", 
   RowBox[{"p_Symbol", "[", 
    RowBox[{"x_", ",", "y_"}], "]"}], "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"{", 
    RowBox[{"p", ",", "2"}], "}"}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BinaryPredicateSymbols", "[", "\[Phi]_", "]"}], ":=", 
  RowBox[{"First", " ", "/@", 
   RowBox[{"Select", "[", 
    RowBox[{
     RowBox[{"PredicateSymbols", "[", "\[Phi]", "]"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "==", "2"}], "&"}]}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"BinaryNonreflexiveAtoms", "[", "\[Phi]_", "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"#", "[", 
        RowBox[{"\[FormalA]", ",", "\[FormalB]"}], "]"}], ",", 
       RowBox[{"#", "[", 
        RowBox[{"\[FormalB]", ",", "\[FormalA]"}], "]"}]}], "}"}], "&"}], "/@",
     " ", 
    RowBox[{"BinaryPredicateSymbols", "[", "\[Phi]", "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PredicateToAtom", "[", 
   RowBox[{"{", 
    RowBox[{"p_", ",", "1"}], "}"}], "]"}], ":=", 
  RowBox[{"p", "[", "\[FormalA]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PredicateToAtom", "[", 
   RowBox[{"{", 
    RowBox[{"p_", ",", "2"}], "}"}], "]"}], ":=", 
  RowBox[{"p", "[", 
   RowBox[{"\[FormalA]", ",", "\[FormalA]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"UnaryAndReflexiveAtoms", "[", "\[Phi]_", "]"}], ":=", " ", 
  RowBox[{"PredicateToAtom", "/@", " ", 
   RowBox[{
   "PredicateSymbols", "[", "\[Phi]", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FOAtoms", "[", "False", "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FOAtoms", "[", "True", "]"}], " ", ":=", " ", 
  RowBox[{"{", "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FOAtoms", "[", 
   RowBox[{"Not", "[", "\[Phi]_", "]"}], "]"}], " ", ":=", " ", 
  RowBox[{"FOAtoms", "[", "\[Phi]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FOAtoms", "[", 
   RowBox[{"\[Phi]_", "\[And]", "\[Psi]_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"FOAtoms", "[", "\[Phi]", "]"}], "\[Union]", 
   RowBox[{"FOAtoms", "[", "\[Psi]", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FOAtoms", "[", 
   RowBox[{"\[Phi]_", "\[Or]", "\[Psi]_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"FOAtoms", "[", "\[Phi]", "]"}], "\[Union]", 
   RowBox[{"FOAtoms", "[", "\[Psi]", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FOAtoms", "[", 
   RowBox[{"\[Phi]_", "\[Implies]", "\[Psi]_"}], "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"FOAtoms", "[", "\[Phi]", "]"}], "\[Union]", 
   RowBox[{"FOAtoms", "[", "\[Psi]", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FOAtoms", "[", "atom_", "]"}], ":=", " ", 
  RowBox[{"{", "atom", "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PositiveAtoms", "[", "model_List", "]"}], ":=", 
  RowBox[{"model", "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"a_", "\[Rule]", "False"}], ")"}], " ", "\[RuleDelayed]", " ", 
      "Nothing"}], ",", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"a_", "\[Rule]", "True"}], ")"}], " ", "\[RuleDelayed]", " ", 
      "a"}]}], "}"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NegativeAtoms", "[", "model_List", "]"}], ":=", 
  RowBox[{"model", "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"a_", "\[Rule]", "True"}], ")"}], " ", "\[RuleDelayed]", " ", 
      "Nothing"}], ",", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"a_", "\[Rule]", "False"}], ")"}], " ", "\[RuleDelayed]", " ", 
      "a"}]}], "}"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PredicateSymbol", "[", 
   RowBox[{"p_Symbol", "[", "x___", "]"}], "]"}], ":=", " ", 
  RowBox[{"{", 
   RowBox[{"p", ",", " ", 
    RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PredicateSymbols", "[", "\[Phi]_", "]"}], ":=", " ", 
  RowBox[{"PredicateSymbol", "/@", " ", 
   RowBox[{"FOAtoms", "[", "\[Phi]", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MakeLiteral", "[", 
   RowBox[{"a_", "->", "True"}], "]"}], ":=", " ", 
  "a"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MakeLiteral", "[", 
   RowBox[{"b_", "->", "False"}], "]"}], ":=", " ", 
  RowBox[{"\[Not]", "b"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"InterpretationToFormula", "[", "f_List", "]"}], ":=", " ", 
  RowBox[{"And", "@@", 
   RowBox[{"(", 
    RowBox[{"MakeLiteral", " ", "/@", " ", "f"}], 
    ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SymbolSetWeight", "[", 
   RowBox[{"set_List", ",", " ", "weights_"}], "]"}], ":=", " ", 
  RowBox[{"Times", "@@", " ", 
   RowBox[{"(", 
    RowBox[{"weights", " ", "/@", "set"}], ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GroundAtomSetWeight", "[", 
   RowBox[{"set_List", ",", " ", "weights_"}], "]"}], ":=", 
  RowBox[{"SymbolSetWeight", "[", 
   RowBox[{
    RowBox[{"PredicateName", "/@", " ", "set"}], ",", " ", "weights"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ModelWeight", "[", 
   RowBox[{
   "model_", ",", " ", "weightsPositive_", ",", " ", "weightsNegative_"}], 
   "]"}], ":=", " ", 
  RowBox[{"(*", " ", 
   RowBox[{"FIXME", " ", "-", " ", 
    RowBox[{
    "this", " ", "should", " ", "be", " ", "easy", " ", "to", " ", "make", 
     " ", "2", "x", " ", "faster"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"GroundAtomSetWeight", "[", 
    RowBox[{
     RowBox[{"PositiveAtoms", "[", "model", "]"}], ",", " ", 
     "weightsPositive"}], "]"}], " ", "*", " ", 
   RowBox[{"GroundAtomSetWeight", "[", 
    RowBox[{
     RowBox[{"NegativeAtoms", "[", "model", "]"}], ",", " ", 
     "weightsNegative"}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AllModels", "[", "False", "]"}], ":=", " ", 
   RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AllModels", "[", 
   RowBox[{"\[Phi]_", ",", "variables_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"modelBool", "\[Function]", 
     RowBox[{"Thread", "[", 
      RowBox[{"variables", "\[Rule]", "modelBool"}], "]"}]}], ")"}], "/@", 
   "\[IndentingNewLine]", 
   RowBox[{"SatisfiabilityInstances", "[", 
    RowBox[{"\[Phi]", ",", "variables", ",", "All"}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WeightedModels", "[", 
   RowBox[{
   "\[Phi]_", ",", "weightsPositive_", ",", " ", "weightsNegative_", ",", " ",
     "variables_"}], "]"}], ":=", 
  RowBox[{"Total", "[", " ", 
   RowBox[{"(*", 
    RowBox[{
    "naive", " ", "WMC", " ", "implementation", " ", "using", " ", "SAT"}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"model", " ", "\[Function]", 
      RowBox[{"ModelWeight", "[", 
       RowBox[{
       "model", ",", " ", "weightsPositive", ",", " ", "weightsNegative"}], 
       "]"}]}], ")"}], "/@", "\[IndentingNewLine]", 
    RowBox[{"AllModels", "[", 
     RowBox[{"\[Phi]", ",", "variables"}], "]"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PredicateToAtom", "[", 
   RowBox[{"{", 
    RowBox[{"p_", ",", "1"}], "}"}], "]"}], ":=", " ", 
  RowBox[{"p", "[", "\[FormalA]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PredicateToAtom", "[", 
   RowBox[{"{", 
    RowBox[{"p_", ",", "2"}], "}"}], "]"}], ":=", " ", 
  RowBox[{"p", "[", 
   RowBox[{"\[FormalA]", ",", "\[FormalA]"}], "]"}]}], "\[IndentingNewLine]", 

 RowBox[{
  RowBox[{
   RowBox[{"CellAtoms", "[", "predicates_List", "]"}], ":=", 
   RowBox[{"PredicateToAtom", "/@", " ", "predicates"}]}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"MakeCell", "[", 
     RowBox[{"atoms_List", ",", "fs_List"}], "]"}], ":=", "  ", 
    RowBox[{"And", "@@", 
     RowBox[{"MapThread", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"#1", "[", "#2", "]"}], "&"}], ",", 
       RowBox[{"{", 
        RowBox[{"fs", ",", "atoms"}], "}"}]}], "]"}]}]}], " ", "*)"}], 
  RowBox[{"(*", " ", 
   RowBox[{
   "just", " ", "a", " ", "helper", " ", "function", " ", "for", " ", 
    "AllCells"}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MakeCell", "[", 
   RowBox[{"atoms_List", ",", "boolVec_List"}], "]"}], ":=", " ", 
  RowBox[{"Thread", "[", 
   RowBox[{"atoms", "\[Rule]", "boolVec"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AllCells", "[", "atoms_List", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"boolVec", " ", "\[Function]", 
     RowBox[{"MakeCell", "[", 
      RowBox[{"atoms", ",", "boolVec"}], "]"}]}], ")"}], "/@", 
   "\[IndentingNewLine]", 
   RowBox[{"Tuples", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"False", ",", "True"}], "}"}], ",", " ", 
     RowBox[{"Length", "[", "atoms", "]"}]}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FormulaCells", "[", "\[Phi]_", "]"}], ":=", " ", 
  RowBox[{"AllCells", "@", 
   RowBox[{"CellAtoms", "@", 
    RowBox[{
    "PredicateSymbols", "[", "\[Phi]", "]"}]}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SwapVariables", "[", "object_", "]"}], ":=", " ", 
  RowBox[{"object", " ", "/.", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[FormalA]", "\[Rule]", "\[FormalB]"}], ",", " ", 
     RowBox[{"\[FormalB]", "\[Rule]", "\[FormalA]"}]}], 
    "}"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FormulaSymmetric", "[", "\[Psi]_", "]"}], ":=", 
  RowBox[{"\[Psi]", "\[And]", 
   RowBox[{"SwapVariables", "[", "\[Psi]", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FormulaReflexive", "[", "\[Psi]_", "]"}], ":=", " ", 
  RowBox[{"\[Psi]", " ", "/.", " ", 
   RowBox[{"\[FormalB]", "\[Rule]", "\[FormalA]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FormulaSimplified", "[", 
   RowBox[{"\[Psi]_", ",", " ", "cell1_", ",", " ", "cell2_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"FormulaSymmetric", "[", "\[Psi]", "]"}], " ", "/.", 
   RowBox[{"Join", "[", 
    RowBox[{"cell1", ",", " ", 
     RowBox[{"SwapVariables", "[", "cell2", "]"}]}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FormulaSimplified", "[", 
   RowBox[{"\[Psi]_", ",", "cell_"}], "]"}], ":=", 
  RowBox[{"FormulaSimplified", "[", 
   RowBox[{"\[Psi]", ",", " ", "cell", ",", " ", "cell"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RTerm", "[", 
   RowBox[{
   "\[Psi]_", ",", "cell1_", ",", "cell2_", ",", "weightsPositive_", ",", " ",
     "weightsNegative_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"WeightedModels", "[", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"Alternative", " ", ":", " ", 
      RowBox[{"syntactic", " ", "approach", " ", "to", " ", "cells"}], ":", 
      "\[IndentingNewLine]", 
      RowBox[{"Simplify", "[", 
       RowBox[{
        RowBox[{"FormulaSymmetric", "[", "\[Psi]", "]"}], "\[And]", " ", 
        RowBox[{"InterpretationToFormula", "[", "cell1", "]"}], "\[And]", 
        RowBox[{"InterpretationToFormula", "@", 
         RowBox[{"SwapVariables", "[", "cell2", "]"}]}]}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Semantic", ":", "\[IndentingNewLine]", 
      RowBox[{"FormulaSimplified2Cell", "[", 
       RowBox[{"\[Psi]", ",", " ", "cell1", ",", " ", "cell2"}], "]"}]}], 
     ","}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"FormulaSimplified2Cell", "[", 
     RowBox[{"\[Psi]", ",", " ", "cell1", ",", " ", "cell2"}], "]"}], ",", 
    "\[IndentingNewLine]", "weightsPositive", ",", " ", "weightsNegative", 
    ",", "\[IndentingNewLine]", 
    RowBox[{"BinaryNonreflexiveAtoms", "[", "\[Psi]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"STerm", "[", 
   RowBox[{
   "\[Psi]_", ",", "cell_", ",", "weightsPositive_", ",", " ", 
    "weightsNegative_"}], "]"}], ":=", 
  RowBox[{"RTerm", "[", 
   RowBox[{
    RowBox[{"FormulaSymmetric", "[", "\[Psi]", "]"}], ",", " ", "cell", ",", 
    " ", "cell", ",", " ", "weightsPositive", ",", "weightsNegative"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WTerm", "[", 
   RowBox[{
   "\[Psi]_", ",", "cell_", ",", "weightsPositive_", ",", " ", 
    "weightsNegative_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"WeightedModels", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"FormulaReflexive", "[", "\[Psi]", "]"}], "\[And]", " ", 
     RowBox[{"InterpretationToFormula", "[", "cell", "]"}]}], ",", 
    "\[IndentingNewLine]", "weightsPositive", ",", " ", "weightsNegative", 
    ",", "\[IndentingNewLine]", 
    RowBox[{"UnaryAndReflexiveAtoms", "[", "\[Psi]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"STerms", "[", 
   RowBox[{
   "\[Psi]_", ",", " ", "weightsPositive_", ",", " ", "weightsNegative_"}], 
   "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"cell", "\[Function]", 
     RowBox[{"STerm", "[", 
      RowBox[{
      "\[Psi]", ",", " ", "cell", ",", " ", "weightsPositive", ",", 
       "weightsNegative"}], "]"}]}], ")"}], " ", "/@", " ", 
   RowBox[{"FormulaCells", "[", "\[Psi]", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"WTerms", "[", 
   RowBox[{
   "\[Psi]_", ",", " ", "weightsPositive_", ",", " ", "weightsNegative_"}], 
   "]"}], ":=", " ", 
  RowBox[{
   RowBox[{"(", 
    RowBox[{"cell", "\[Function]", 
     RowBox[{"WTerm", "[", 
      RowBox[{
      "\[Psi]", ",", " ", "cell", ",", " ", "weightsPositive", ",", 
       "weightsNegative"}], "]"}]}], ")"}], " ", "/@", " ", 
   RowBox[{"FormulaCells", "[", "\[Psi]", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RTerms", "[", 
   RowBox[{
   "\[Psi]_", ",", " ", "weightsPositive_", ",", " ", "weightsNegative_"}], 
   "]"}], " ", ":=", " ", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"cells", " ", "=", " ", 
       RowBox[{"FormulaCells", "[", "\[Psi]", "]"}]}], ",", " ", "length"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"length", " ", "=", " ", 
      RowBox[{"Length", "[", "cells", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"row", " ", "\[Function]", 
        RowBox[{"PadRight", "[", 
         RowBox[{"row", ",", " ", "length"}], "]"}]}], ")"}], " ", "/@", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"RTerm", "[", 
         RowBox[{"\[Psi]", ",", " ", 
          RowBox[{
          "cells", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
          ",", " ", 
          RowBox[{
          "cells", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
          ",", " ", "weightsPositive", ",", "weightsNegative"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", " ", "1", ",", " ", "length"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", " ", "1", ",", " ", "length"}], "}"}]}], 
       "\[IndentingNewLine]", "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Compatible", "[", 
   RowBox[{"i_Integer", ",", " ", "cliquePart_List", ",", " ", 
    RowBox[{"{", 
     RowBox[{"s_", ",", "w_", ",", "r_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"all", "=", 
       RowBox[{"Range", "@", 
        RowBox[{"Length", "[", "s", "]"}]}]}], ",", "\[IndentingNewLine]", 
      RowBox[{"cond3", "=", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"j_", ",", "k_"}], "}"}], "\[RuleDelayed]", " ", 
        RowBox[{
         RowBox[{"j", "<", "k"}], "\[Implies]", " ", 
         RowBox[{
          RowBox[{"r", "\[LeftDoubleBracket]", 
           RowBox[{"i", ",", "k"}], "\[RightDoubleBracket]"}], "\[Equal]", 
          RowBox[{"r", "\[LeftDoubleBracket]", 
           RowBox[{"j", ",", "k"}], "\[RightDoubleBracket]"}]}]}]}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"cond4", "=", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"j_", ",", "k_", ",", "l_"}], "}"}], "\[RuleDelayed]", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"i", "<", "j"}], "\[And]", 
           RowBox[{"k", "<", "l"}]}], ")"}], "\[Implies]", " ", 
         RowBox[{
          RowBox[{"r", "\[LeftDoubleBracket]", 
           RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], "\[Equal]", 
          RowBox[{"r", "\[LeftDoubleBracket]", 
           RowBox[{"k", ",", "l"}], "\[RightDoubleBracket]"}]}]}]}]}]}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"And", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"AllTrue", "[", 
       RowBox[{"cliquePart", ",", 
        RowBox[{"j", "\[Function]", 
         RowBox[{
          RowBox[{"s", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
           "\[Equal]", 
          RowBox[{
          "s", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}]}]}], 
       "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"AllTrue", "[", 
       RowBox[{"cliquePart", ",", 
        RowBox[{"j", "\[Function]", 
         RowBox[{
          RowBox[{"w", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}],
           "\[Equal]", 
          RowBox[{
          "s", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}]}]}], 
       "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"And", "@@", 
        RowBox[{"Tuples", "[", 
         RowBox[{"{", 
          RowBox[{"cliquePart", ",", 
           RowBox[{"Complement", "[", 
            RowBox[{"all", ",", " ", "cliquePart"}], "]"}]}], "}"}], "]"}]}], 
       "/.", "cond3"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"And", "@@", 
        RowBox[{"Tuples", "[", 
         RowBox[{"{", 
          RowBox[{
          "cliquePart", ",", " ", "cliquePart", ",", " ", "cliquePart"}], 
          "}"}], "]"}]}], "/.", "cond4"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Cliques", "[", 
    RowBox[{"{", 
     RowBox[{"s_", ",", "w_", ",", "r_"}], "}"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"i", ",", " ", "j", ",", " ", 
       RowBox[{"cliques", "=", 
        RowBox[{"{", "}"}]}], ",", " ", 
       RowBox[{"length", " ", "=", " ", 
        RowBox[{"Length", "[", "s", "]"}]}], ",", "current", ",", " ", 
       "all"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"all", " ", "=", " ", 
       RowBox[{"Range", "[", "length", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "all", "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"current", " ", "=", " ", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"cell", "\[Function]", " ", 
            RowBox[{"If", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Compatible", "[", 
               RowBox[{"cell", ",", " ", "current", ",", " ", 
                RowBox[{"{", 
                 RowBox[{"s", ",", "w", ",", "r"}], "}"}]}], "]"}], " ", ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"AppendTo", "[", 
                RowBox[{"current", ",", " ", "cell"}], "]"}], ";", " ", 
               RowBox[{"all", " ", "=", " ", 
                RowBox[{"all", " ", "/.", " ", 
                 RowBox[{"cell", " ", "\[Rule]", " ", "Nothing"}]}]}], 
               ";"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]",
            ")"}], " ", "/@", " ", "all"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"cliques", ",", " ", "current"}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "cliques"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GetGTerm", "[", 
     RowBox[{"0", ",", " ", "n_Integer", ",", "cliqueIds_List"}], "]"}], ":=",
     " ", 
    RowBox[{
     RowBox[{"GetGTerm", "[", 
      RowBox[{"0", ",", " ", "n", ",", "cliqueIds"}], "]"}], " ", "=", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"Module", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"i", "\[Function]"}], " ", ")"}], " ", "/@", " ", 
         RowBox[{"Range", "[", 
          RowBox[{"1", ",", "k"}], "]"}]}], "\[IndentingNewLine]", "]"}], 
       "\[IndentingNewLine]", 
       RowBox[{"GetGTerm", "[", 
        RowBox[{"p_Integer", ",", " ", "n_Integer", ",", "cliqueIds_List"}], 
        "]"}]}], ":=", " ", 
      RowBox[{
       RowBox[{"GetGTerm", "[", 
        RowBox[{"p", ",", " ", "n", ",", "cliqueIds"}], "]"}], " ", "=", " ", 
       
       RowBox[{"Module", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"s", "=", "0"}], "}"}], ","}], "\[IndentingNewLine]", 
        "]"}]}]}]}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetDTerm", "[", 
    RowBox[{"c_", ",", " ", "k_", ",", "n_"}], "]"}], " ", ":=", " ", 
   RowBox[{"GetDTerm", "[", 
    RowBox[{"c", ",", "1", ",", " ", "k", ",", "n"}], "]"}]}], 
  " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"GetDTerm", "[", 
   RowBox[{"c_", ",", "i_", ",", " ", "k_", ",", "n_"}], "]"}], " ", ":=", 
  " ", "Nothing"}]}], "Input",
 CellChangeTimes->{{3.826691908173477*^9, 3.826691923275236*^9}, {
   3.8266943734494*^9, 3.826694384949321*^9}, {3.826696719597742*^9, 
   3.826696741314296*^9}, {3.826696887890477*^9, 3.826696890586649*^9}, {
   3.826698545236833*^9, 3.82669854743611*^9}, {3.8266989941890793`*^9, 
   3.826699042378667*^9}, {3.826699112856061*^9, 3.826699123718796*^9}, {
   3.82669940165061*^9, 3.826699419960739*^9}, {3.826699598801098*^9, 
   3.826699632078167*^9}, {3.8266996655265017`*^9, 3.826699720825424*^9}, {
   3.826699786981991*^9, 3.826699813892815*^9}, {3.826699879796061*^9, 
   3.826699883905335*^9}, {3.8266999194673777`*^9, 3.826699933158588*^9}, 
   3.826699969104002*^9, {3.826700012274729*^9, 3.826700043681284*^9}, {
   3.826700086880082*^9, 3.826700150171782*^9}, {3.826700225590479*^9, 
   3.826700333466172*^9}, {3.8267003641925297`*^9, 3.826700408846528*^9}, {
   3.826700444903625*^9, 3.826700449460507*^9}, {3.8267005340590563`*^9, 
   3.826700568662376*^9}, {3.826700766822391*^9, 3.826700795346916*^9}, {
   3.8267010424257193`*^9, 3.826701045861957*^9}, {3.8267012253125687`*^9, 
   3.826701246347601*^9}, {3.826701284937923*^9, 3.826701427354864*^9}, {
   3.826701463580579*^9, 3.826701471848776*^9}, {3.8267018740990057`*^9, 
   3.826701917416954*^9}, 3.826702283191683*^9, {3.826705194988215*^9, 
   3.826705337877451*^9}, {3.8267053814033117`*^9, 3.826705404970828*^9}, {
   3.826705442371807*^9, 3.826705464311863*^9}, {3.82670553421457*^9, 
   3.826705573762063*^9}, {3.826705692294456*^9, 3.826705894606629*^9}, {
   3.826706740393756*^9, 3.8267067571069717`*^9}, {3.8267068413362913`*^9, 
   3.8267069970710087`*^9}, {3.826707033722508*^9, 3.8267070366287813`*^9}, {
   3.826709236360263*^9, 3.8267092488614683`*^9}, {3.826709840693407*^9, 
   3.826709919313323*^9}, {3.826710353655128*^9, 3.826710358971368*^9}, {
   3.826710446022162*^9, 3.826710454829954*^9}, {3.826710528785511*^9, 
   3.826710552908914*^9}, {3.826711140107106*^9, 3.826711141034778*^9}, {
   3.826770141889476*^9, 3.826770147009123*^9}, {3.826770465766946*^9, 
   3.826770583510621*^9}, {3.826770684871632*^9, 3.826770702422164*^9}, {
   3.826770853485091*^9, 3.826770931323544*^9}, {3.8267709849139338`*^9, 
   3.826771003352418*^9}, {3.82677107493321*^9, 3.826771154186501*^9}, {
   3.826771190888564*^9, 3.8267712068558197`*^9}, {3.826772324555181*^9, 
   3.826772352986643*^9}, {3.8267724847155113`*^9, 3.826772491503093*^9}, {
   3.826772532967822*^9, 3.826772591075437*^9}, {3.826772779313925*^9, 
   3.8267727818571167`*^9}, {3.826772819333974*^9, 3.826772911132647*^9}, {
   3.826772999117989*^9, 3.826773025234232*^9}, {3.8267731298730307`*^9, 
   3.8267731410045633`*^9}, 3.82677340296294*^9, {3.8267734611022253`*^9, 
   3.826773487118004*^9}, {3.826773774201734*^9, 3.826773776430725*^9}, {
   3.826773915864647*^9, 3.826773954867942*^9}, {3.826774019441201*^9, 
   3.8267740362696047`*^9}, {3.826774075764183*^9, 3.8267742614049807`*^9}, {
   3.826774297889739*^9, 3.826774319116613*^9}, {3.826774375630319*^9, 
   3.826774547985279*^9}, {3.8267745976747923`*^9, 3.8267746369191236`*^9}, {
   3.8267746952389174`*^9, 3.826774717378902*^9}, {3.826776432780423*^9, 
   3.826776511622465*^9}, {3.826777602795004*^9, 3.826777629127974*^9}, {
   3.826778605190192*^9, 3.8267786290803833`*^9}, {3.826778665013783*^9, 
   3.826778863719534*^9}, {3.826779048235779*^9, 3.826779057911319*^9}, {
   3.826779251029684*^9, 3.826779287002925*^9}, {3.826779343329282*^9, 
   3.826779357336011*^9}, {3.826779431518835*^9, 3.8267794511221933`*^9}, {
   3.826780141591258*^9, 3.826780149126049*^9}, {3.826780206185391*^9, 
   3.82678020703806*^9}, {3.8267808097394133`*^9, 3.8267808098912582`*^9}, {
   3.82678139198076*^9, 3.8267813922233887`*^9}, {3.826781444096285*^9, 
   3.826781444232154*^9}, {3.826797198806508*^9, 3.826797243076335*^9}, {
   3.8267973019466677`*^9, 3.826797389530806*^9}, {3.826797814909292*^9, 
   3.826797999365364*^9}, {3.826798110502787*^9, 3.826798276387518*^9}, {
   3.82679849770181*^9, 3.8267984990031843`*^9}, 3.826799113849916*^9, {
   3.826799370299933*^9, 3.826799423792611*^9}, {3.82679946759827*^9, 
   3.826799639354917*^9}, {3.82679979565377*^9, 3.826799814261026*^9}, {
   3.826800043313301*^9, 3.826800068607938*^9}, {3.8268001037298822`*^9, 
   3.8268003503377037`*^9}, {3.826800392231367*^9, 3.826800397919237*^9}, {
   3.826801380495721*^9, 3.826801382343668*^9}, {3.826801893974278*^9, 
   3.8268019177732153`*^9}, {3.826802102011656*^9, 3.826802342928423*^9}, {
   3.826802373332333*^9, 3.8268023960322943`*^9}, {3.826802458834202*^9, 
   3.826802541404107*^9}, {3.827296223325539*^9, 3.827296225605289*^9}, {
   3.827296263986578*^9, 3.827296291465073*^9}, {3.827296332863793*^9, 
   3.827296353125709*^9}, {3.8272976190386257`*^9, 3.8272976326292343`*^9}, {
   3.827298035763824*^9, 3.827298067790472*^9}, {3.827298117709277*^9, 
   3.8272981384407578`*^9}, 3.827300239749887*^9, {3.827301154141986*^9, 
   3.827301239976479*^9}, {3.827301828810267*^9, 3.827301861393035*^9}, {
   3.827301892239365*^9, 3.8273019997861423`*^9}, {3.827302031544429*^9, 
   3.827302255543271*^9}, {3.827302304523499*^9, 3.827302321580572*^9}, {
   3.82730248286719*^9, 3.8273025455406637`*^9}, {3.827302608101035*^9, 
   3.827302617630672*^9}, {3.827465227052306*^9, 3.8274652357712183`*^9}, {
   3.827465453730818*^9, 3.8274654953603287`*^9}, {3.827466585441311*^9, 
   3.827466614087874*^9}, {3.827467552881259*^9, 3.827467558249358*^9}, {
   3.827467610911867*^9, 3.827467618280074*^9}, {3.8274676677975388`*^9, 
   3.827467701754944*^9}, {3.827471543491213*^9, 3.8274715488008966`*^9}, {
   3.836278108933132*^9, 3.836278114187827*^9}, {3.8362819426280737`*^9, 
   3.83628195502315*^9}, {3.8364496937759247`*^9, 3.836449711676116*^9}, {
   3.836456651041934*^9, 3.836456655832328*^9}, {3.838100534554991*^9, 
   3.838100605720351*^9}, 3.838101269334474*^9, {3.8381020227796707`*^9, 
   3.838102023306238*^9}, {3.838102168928934*^9, 3.838102370223971*^9}, {
   3.8381080347049103`*^9, 3.8381080661841497`*^9}, {3.838111708903923*^9, 
   3.8381117597921257`*^9}, {3.838122424492795*^9, 3.8381224247200613`*^9}, {
   3.838122515320002*^9, 3.838122540114081*^9}, {3.8381225771795473`*^9, 
   3.838122605654173*^9}, {3.83812343625648*^9, 3.838123437520603*^9}, {
   3.838123516788821*^9, 3.8381235187720137`*^9}, {3.838184360478383*^9, 
   3.8381844836167383`*^9}, {3.838184578091997*^9, 3.838184579179769*^9}, {
   3.8381886954017773`*^9, 3.838188725654476*^9}, {3.8381892313484917`*^9, 
   3.83818923159582*^9}, {3.838189276202713*^9, 3.838189280298307*^9}, {
   3.838190002261059*^9, 3.8381900353954973`*^9}, {3.838190120096134*^9, 
   3.838190132071341*^9}, {3.8381914350321217`*^9, 3.838191444540365*^9}, 
   3.838191526761639*^9, {3.838191587309626*^9, 3.8381916119806223`*^9}, {
   3.838191686560042*^9, 3.838191705175729*^9}, {3.838191747236854*^9, 
   3.838191862416596*^9}, {3.83819192810434*^9, 3.838191947260088*^9}, {
   3.8381919846209707`*^9, 3.838191985994561*^9}, {3.8381935988945427`*^9, 
   3.838193662655756*^9}, {3.83819509839776*^9, 3.8381951039734993`*^9}, {
   3.838197016459901*^9, 3.838197033220586*^9}, {3.8381970764112387`*^9, 
   3.838197083408684*^9}, {3.8381974671047773`*^9, 3.8381974712206573`*^9}, {
   3.8381975070272217`*^9, 3.838197533530995*^9}, {3.838354421593877*^9, 
   3.838354428516543*^9}, {3.838354495013659*^9, 3.838354500591889*^9}, {
   3.8387000014189177`*^9, 3.838700040586*^9}, {3.838884462753167*^9, 
   3.838884488264164*^9}, {3.8388846579365187`*^9, 3.838884718858076*^9}, {
   3.838886576521461*^9, 3.838886581895876*^9}, {3.838957099851025*^9, 
   3.83895711017019*^9}, {3.839924546896613*^9, 3.8399245696914377`*^9}, {
   3.839925433256225*^9, 3.8399254333940477`*^9}, {3.839925587260982*^9, 
   3.839925614183669*^9}, {3.839925999640648*^9, 3.839926000328596*^9}, {
   3.8399268152486153`*^9, 3.839926860177307*^9}, {3.839926995151889*^9, 
   3.8399270005958967`*^9}, {3.839927260900875*^9, 3.8399272923240757`*^9}, {
   3.839927344265706*^9, 3.8399273741193647`*^9}, {3.839927449932732*^9, 
   3.8399274620131207`*^9}, {3.839927497146934*^9, 3.839927671803705*^9}, {
   3.8399277079784937`*^9, 3.839927717916993*^9}, {3.839927770987331*^9, 
   3.839927896064042*^9}, {3.8399899620051928`*^9, 3.839989972656386*^9}, {
   3.839990069061261*^9, 3.839990158472969*^9}, {3.839990210906145*^9, 
   3.839990252681596*^9}, {3.83999074064861*^9, 3.8399907829938374`*^9}, {
   3.8399913126625347`*^9, 3.83999141226851*^9}, {3.839991715545762*^9, 
   3.8399917671669827`*^9}},
 CellLabel->
  "In[975]:=",ExpressionUUID->"bd4dac13-24d5-43d7-ae76-3f67079096f2"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"CellGraphEdges", "[", "cells_", "]"}], " ", ":=", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
         "cells", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
         "\[DirectedEdge]", " ", 
         RowBox[{
         "cells", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}], 
        ",", " ", 
        RowBox[{"{", 
         RowBox[{"j", ",", " ", "1", ",", " ", 
          RowBox[{"Length", "[", "cells", "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"j", "-", "1"}]}], "}"}]}], "]"}], ",", "2"}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CellGraph", "[", 
     RowBox[{
     "\[Phi]_", ",", "weightsPositive_", ",", " ", "weightsNegative_"}], 
     "]"}], ":=", " ", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"cells", " ", "=", 
         RowBox[{"FormulaCells", "[", "\[Phi]", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"edgeLabeling", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"cell1_", "\[DirectedEdge]", "cell2_"}], ")"}], 
          "\[RuleDelayed]", " ", 
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"cell1", "\[DirectedEdge]", "cell2"}], ")"}], " ", 
            "\[Rule]", "\[IndentingNewLine]", 
            RowBox[{"RTerm", "[", 
             RowBox[{
             "\[Phi]", ",", " ", "cell1", ",", "cell2", ",", " ", 
              "weightsPositive", ",", " ", "weightsNegative"}], "]"}]}], 
           ")"}]}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"vertexLabeling", "=", 
         RowBox[{"cell", "\[Function]", 
          RowBox[{"(", "\[IndentingNewLine]", 
           RowBox[{"cell", " ", "\[Rule]", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"STerm", "[", 
               RowBox[{
               "\[Phi]", ",", " ", "cell", ",", " ", "weightsPositive", ",", 
                " ", "weightsNegative"}], "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"WTerm", "[", 
               RowBox[{
               "\[Phi]", ",", " ", "cell", ",", " ", "weightsPositive", ",", 
                " ", "weightsNegative"}], "]"}]}], "}"}]}], ")"}]}]}]}], 
       "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"With", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"edges", "=", " ", 
          RowBox[{"CellGraphEdges", "[", "cells", "]"}]}], "}"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Graph", "[", "\[IndentingNewLine]", 
         RowBox[{"edges", ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"EdgeLabels", "\[Rule]", " ", "edges"}], " ", "/.", " ", 
           "edgeLabeling"}], ",", "\[IndentingNewLine]", 
          RowBox[{"VertexLabels", "\[Rule]", 
           RowBox[{
            RowBox[{"(", "vertexLabeling", ")"}], " ", "/@", " ", "cells"}]}],
           ",", "\[IndentingNewLine]", 
          RowBox[{"GraphLayout", "->", "\"\<CircularEmbedding\>\""}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"g", "=", 
     RowBox[{"CellGraph", "[", 
      RowBox[{
      "exampleDerangements", ",", "weightsPositiveDerangements", ",", 
       "weightsNegativeDerangements"}], "]"}]}], "*)"}]}]}]], "Input",
 CellChangeTimes->{{3.82677631664717*^9, 3.826776392106119*^9}, {
   3.8267765332843943`*^9, 3.8267766975869493`*^9}, {3.826776732923592*^9, 
   3.826776879441977*^9}, {3.826776914408204*^9, 3.826777159010041*^9}, {
   3.8267772126363697`*^9, 3.826777281654173*^9}, {3.826777409263867*^9, 
   3.82677752628185*^9}, {3.826779530135537*^9, 3.8267795697076406`*^9}, {
   3.826779604479659*^9, 3.8267796593012533`*^9}, {3.826779690132078*^9, 
   3.826779735226982*^9}, {3.826779768791193*^9, 3.8267799442464542`*^9}, {
   3.826779999790695*^9, 3.826780008762195*^9}, {3.826780216348117*^9, 
   3.8267802165420732`*^9}, {3.826780247717576*^9, 3.826780251767538*^9}, {
   3.82678032029327*^9, 3.826780380809041*^9}, {3.826780641696588*^9, 
   3.826780668223263*^9}, 3.826781434212461*^9, {3.826781507117353*^9, 
   3.826781639628915*^9}, 3.826781671652635*^9, {3.826781728169271*^9, 
   3.826781762582808*^9}, {3.8267818619143267`*^9, 3.826781873473317*^9}, {
   3.8267819217592897`*^9, 3.826781945990067*^9}, {3.826781976836549*^9, 
   3.826782016579034*^9}, {3.826782048146036*^9, 3.826782048744166*^9}, {
   3.826787002171405*^9, 3.826787002506032*^9}, {3.8267873756492157`*^9, 
   3.8267873817162027`*^9}, {3.827374667603437*^9, 3.827374674262203*^9}, {
   3.839990023453744*^9, 3.839990025503839*^9}},
 CellLabel->
  "In[1029]:=",ExpressionUUID->"cb5ccc7e-7f44-46d8-b840-19729f63b518"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Implementation", " ", "of", " ", "WFOMC", " ", "according", " ", "to", 
     " ", "formula", " ", 
     RowBox[{"(", "1", ")"}], " ", "in", " ", "Faster", " ", "Lifting", " ", 
     "for", " ", "Two"}], "-", 
    RowBox[{
    "Variable", " ", "Logic", " ", "using", " ", "Cell", " ", "Graphs"}]}], 
   " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"OrderedPartitions", "[", 
     RowBox[{"n_Integer", ",", "m_Integer"}], "]"}], ":=", " ", 
    RowBox[{"Flatten", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Permutations", "[", 
         RowBox[{"PadRight", "[", 
          RowBox[{"#", ",", "m"}], "]"}], "]"}], "&"}], "\[IndentingNewLine]",
        "/@", 
       RowBox[{"IntegerPartitions", "[", 
        RowBox[{"n", ",", "m"}], "]"}]}], ",", "\[IndentingNewLine]", "1"}], 
     "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Pow", "[", 
     RowBox[{"0", ",", "0"}], "]"}], ":=", "1"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Pow", "[", 
     RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
    RowBox[{"a", "^", "b"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"WFOMC1", "[", 
     RowBox[{
     "\[Phi]_", ",", "n_", ",", "weightsPositive_", ",", " ", 
      "weightsNegative_"}], "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"s", "=", 
         RowBox[{"STerms", "[", 
          RowBox[{
          "\[Phi]", ",", " ", "weightsPositive", ",", " ", 
           "weightsNegative"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"w", "=", 
         RowBox[{"WTerms", "[", 
          RowBox[{
          "\[Phi]", ",", " ", "weightsPositive", ",", " ", 
           "weightsNegative"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"r", "=", 
         RowBox[{"RTerms", "[", 
          RowBox[{
          "\[Phi]", ",", " ", "weightsPositive", ",", " ", 
           "weightsNegative"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"u", "=", 
         RowBox[{"2", "^", 
          RowBox[{"(", 
           RowBox[{"Length", "@", 
            RowBox[{"PredicateSymbols", "[", "\[Phi]", "]"}]}], " ", 
           ")"}]}]}], ",", "\[IndentingNewLine]", "i", ",", "j"}], "}"}], ",",
       "\[IndentingNewLine]", 
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"partition", " ", "|->", " ", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Multinomial", "[", 
            RowBox[{"Sequence", "@@", "partition"}], "]"}], " ", "*", 
           "\[IndentingNewLine]", 
           RowBox[{"Product", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"r", "\[LeftDoubleBracket]", 
               RowBox[{"i", ",", "j"}], "\[RightDoubleBracket]"}], "~", "Pow",
               "~", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                "partition", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "*", 
                RowBox[{
                "partition", "\[LeftDoubleBracket]", "j", 
                 "\[RightDoubleBracket]"}]}], ")"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", "u"}], "}"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", " ", ",", " ", 
               RowBox[{"j", "-", "1"}]}], "}"}]}], "]"}], "*", 
           "\[IndentingNewLine]", 
           RowBox[{"Product", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
               "s", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               "~", "Pow", "~", 
               RowBox[{"Binomial", "[", 
                RowBox[{
                 RowBox[{
                 "partition", "\[LeftDoubleBracket]", "i", 
                  "\[RightDoubleBracket]"}], ",", "2"}], "]"}]}], " ", "*", 
              "\[IndentingNewLine]", " ", 
              RowBox[{
               RowBox[{
               "w", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}], 
               "~", "Pow", "~", 
               RowBox[{
               "partition", "\[LeftDoubleBracket]", "i", 
                "\[RightDoubleBracket]"}]}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", "u"}], "}"}]}], "]"}]}]}], 
         "\[IndentingNewLine]", ")"}], " ", "/@", " ", 
        RowBox[{"OrderedPartitions", "[", 
         RowBox[{"n", ",", " ", "u"}], "]"}]}], "]"}]}], 
     "\[IndentingNewLine]", "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.837671520214148*^9, 3.837671559005844*^9}, {
  3.83767175868404*^9, 3.837671836650036*^9}, {3.837676078777917*^9, 
  3.8376761046086807`*^9}, {3.837677350649568*^9, 3.837677351937161*^9}, {
  3.837678843118335*^9, 3.837678850990128*^9}, {3.837678890276106*^9, 
  3.837678925290481*^9}, {3.837678958848846*^9, 3.837678976703998*^9}, {
  3.837679016694084*^9, 3.8376793311201487`*^9}, {3.8377469641332273`*^9, 
  3.837746978068305*^9}, {3.837747023042777*^9, 3.837747067350965*^9}, {
  3.8377472368946753`*^9, 3.8377472703717403`*^9}, {3.837747438573263*^9, 
  3.837747440265904*^9}, {3.837747477906584*^9, 3.837747496104636*^9}, {
  3.838367477804426*^9, 3.8383674923385878`*^9}, {3.8384456841657877`*^9, 
  3.838445684684894*^9}, {3.838695013887693*^9, 3.8386950144711227`*^9}},
 CellLabel->
  "In[1031]:=",ExpressionUUID->"de9d90ff-36d4-4acd-a124-54bc81661d37"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"maxN", "=", "10"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"wfomc", "=", 
   RowBox[{"Table", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"WFOMC1", "[", 
      RowBox[{
      "exampleDerangements", ",", "n", ",", "weightsPositiveDerangements", 
       ",", "weightsNegativeDerangements"}], "]"}], ",", 
     "\[IndentingNewLine]", " ", 
     RowBox[{"{", 
      RowBox[{"n", ",", " ", "0", ",", " ", "maxN"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"wfomcCc", " ", "=", " ", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"Coefficient", "[", 
     RowBox[{
      RowBox[{"wfomc", "[", 
       RowBox[{"[", 
        RowBox[{"n", "+", "1"}], "]"}], "]"}], ",", "\[FormalZ]", ",", "n"}], 
     "]"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"n", ",", "0", ",", "maxN"}], "}"}]}], 
   "]"}]}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.837671569973804*^9, 3.8376715949630013`*^9}, {
   3.837671627206588*^9, 3.837671631546236*^9}, {3.837678818766939*^9, 
   3.837678831829865*^9}, {3.837678937946063*^9, 3.8376789529351254`*^9}, {
   3.837679364693651*^9, 3.837679417960854*^9}, {3.838111781844524*^9, 
   3.838111784124291*^9}, {3.8381118428259373`*^9, 3.838111910430691*^9}, {
   3.838698894148209*^9, 3.838698906137195*^9}, {3.838699871003758*^9, 
   3.8386998807575274`*^9}, {3.8387000986729717`*^9, 3.838700114533228*^9}, {
   3.838884395033263*^9, 3.838884442692211*^9}, 3.838885201886492*^9, {
   3.839925781031042*^9, 3.83992578198174*^9}, {3.839990422206552*^9, 
   3.839990711507616*^9}},
 CellLabel->
  "In[1035]:=",ExpressionUUID->"3967da30-0426-4e51-8fed-f7c482dc836e"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
  "1", ",", "0", ",", "1", ",", "2", ",", "9", ",", "44", ",", "265", ",", 
   "1854", ",", "14833", ",", "133496", ",", "1334961"}], "}"}]], "Output",
 CellChangeTimes->{{3.837671573612368*^9, 3.837671595498357*^9}, 
   3.837671631855782*^9, {3.837678823257477*^9, 3.837678832158881*^9}, {
   3.837678939241272*^9, 3.83767895328126*^9}, {3.8376793938334217`*^9, 
   3.837679420199458*^9}, 3.837745785659285*^9, 3.837746983196039*^9, {
   3.837747250296301*^9, 3.8377472724534893`*^9}, 3.837747464566654*^9, 
   3.838090773490415*^9, 3.838092410185232*^9, 3.838093499868433*^9, {
   3.838093576075965*^9, 3.8380935923208027`*^9}, 3.838094131970779*^9, {
   3.838099053156966*^9, 3.8380990650603533`*^9}, 3.838102379617313*^9, 
   3.838103145302347*^9, 3.838108071159771*^9, {3.838111744725732*^9, 
   3.838111784742243*^9}, {3.838111906302454*^9, 3.838111911175551*^9}, 
   3.83812255757415*^9, 3.838122610587903*^9, 3.8381234411805*^9, 
   3.838183710998446*^9, 3.838184258966941*^9, {3.838184374123165*^9, 
   3.838184488370401*^9}, 3.838184583949355*^9, {3.83818870993018*^9, 
   3.838188730323399*^9}, 3.838189245691696*^9, 3.8381892837754993`*^9, 
   3.838191834650038*^9, 3.838191865897613*^9, {3.838191930535947*^9, 
   3.8381919512149963`*^9}, 3.838191989338784*^9, 3.838193627078986*^9, 
   3.838193666058004*^9, 3.8381969996710587`*^9, 3.838197036964589*^9, 
   3.83819708790653*^9, 3.838197474412085*^9, {3.838197518412426*^9, 
   3.838197537022626*^9}, 3.838354173953002*^9, 3.8383544325390043`*^9, {
   3.838354559879693*^9, 3.8383545844135427`*^9}, 3.838437454340425*^9, 
   3.8386949610540257`*^9, {3.838698889811092*^9, 3.838698906779139*^9}, {
   3.838699821471425*^9, 3.83869988477948*^9}, {3.838700087249617*^9, 
   3.838700115149205*^9}, 3.838883982557371*^9, {3.838884425674006*^9, 
   3.838884466446857*^9}, {3.838884509684677*^9, 3.838884519082439*^9}, {
   3.838884679375298*^9, 3.838884722427343*^9}, 3.8388852023435917`*^9, 
   3.8388865547976103`*^9, 3.838886585295733*^9, 3.8389565196962357`*^9, 
   3.838957068295257*^9, 3.838957113777787*^9, 3.839300318239327*^9, 
   3.839907181322254*^9, 3.839922473547883*^9, 3.839925437534092*^9, 
   3.839925619759066*^9, {3.839925769851269*^9, 3.839925782866544*^9}, 
   3.839926017961771*^9, 3.839926863715646*^9, 3.8399279849063396`*^9, 
   3.8399881568252697`*^9, 3.8399899837842407`*^9, 3.8399901625326967`*^9, 
   3.839990393910696*^9, {3.8399904384614763`*^9, 3.839990500460194*^9}, {
   3.839990577014641*^9, 3.8399906022248363`*^9}, {3.839990651629342*^9, 
   3.839990714802765*^9}, 3.8399907905538397`*^9, 3.8399913500436907`*^9, 
   3.8399914200377483`*^9, {3.8399917374893837`*^9, 3.839991773360799*^9}, 
   3.839991844492547*^9},
 CellLabel->
  "Out[1037]=",ExpressionUUID->"009daa45-134e-471d-8d49-4f677baaca94"]
}, Open  ]]
},
WindowSize->{1368.7128712871288`, 749.2277227722773},
WindowMargins->{{1368.7128712871288`, Automatic}, {0, Automatic}},
DockedCells->{},
Magnification:>0.8 Inherited,
FrontEndVersion->"12.3 for Linux x86 (64-bit) (June 19, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"3f7ebace-b87e-4310-9597-9cae25c330a8"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 32062, 723, 2000, "Input",ExpressionUUID->"bd4dac13-24d5-43d7-ae76-3f67079096f2"],
Cell[32623, 745, 5084, 108, 420, "Input",ExpressionUUID->"cb5ccc7e-7f44-46d8-b840-19729f63b518"],
Cell[37710, 855, 5664, 133, 443, "Input",ExpressionUUID->"de9d90ff-36d4-4acd-a124-54bc81661d37"],
Cell[CellGroupData[{
Cell[43399, 992, 1678, 38, 110, "Input",ExpressionUUID->"3967da30-0426-4e51-8fed-f7c482dc836e"],
Cell[45080, 1032, 2834, 42, 50, "Output",ExpressionUUID->"009daa45-134e-471d-8d49-4f677baaca94"]
}, Open  ]]
}
]
*)

